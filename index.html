<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Toko Otomatis — Demo</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#e6eef6;
    }
    body{margin:0;background:linear-gradient(180deg,#071129 0%, #081026 60%);min-height:100vh;padding:24px;}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:20px}
    h1{margin:0;font-size:20px;letter-spacing:0.4px}
    .muted{color:var(--muted);font-size:13px}
    .wrap{display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:start}
    .panel{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 4px 20px rgba(2,6,23,0.6)}
    .search{display:flex;gap:8px;margin-bottom:12px}
    input[type="search"]{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
    button{padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#022;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:8px}
    .price{font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    .cart-item{display:flex;gap:10px;align-items:center;margin-bottom:8px}
    .qty{width:44px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    footer{margin-top:18px;font-size:13px;color:var(--muted);text-align:center}
    @media(max-width:900px){
      .wrap{grid-template-columns:1fr}
      .panel.right{order:-1}
    }
    /* tiny badge */
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:12px}
    /* helper */
    .flex{display:flex;gap:10px;align-items:center}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Toko Otomatis — Demo</h1>
      <div class="muted">"Beli cepat, kirim cepet* (*simulasi saja — sediakan rasa sabar)".</div>
    </div>
    <div class="flex">
      <div class="badge" id="saldoBadge">Saldo: Rp <span id="saldo">0</span></div>
      <div class="badge" id="cartCount">Keranjang: <span id="count">0</span></div>
    </div>
  </header>

  <main class="wrap">
    <!-- katalog -->
    <section class="panel left">
      <div class="search">
        <input id="q" type="search" placeholder="Cari produk... mis. 'kaos'">
        <select id="sort" title="Urutkan">
          <option value="default">Urutkan: Rekomendasi</option>
          <option value="price-asc">Harga: Rendah → Tinggi</option>
          <option value="price-desc">Harga: Tinggi → Rendah</option>
        </select>
        <button id="addSaldo">+ Saldo</button>
      </div>

      <div class="flex" style="justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="muted">Produk</div>
        <div class="muted">Diskon otomatis aktif saat beli ≥ 3 item</div>
      </div>

      <div id="grid" class="grid"></div>
    </section>

    <!-- keranjang -->
    <aside class="panel right">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div class="muted">Keranjang</div>
        <div class="small">Pesanan otomatis: <span id="autoMode">ON</span></div>
      </div>

      <div id="cartList" style="min-height:160px"></div>

      <div style="margin-top:12px">
        <div class="muted">Total:</div>
        <div style="font-size:18px;font-weight:700" id="totalRp">Rp 0</div>
        <div class="small muted">Diskon jika syarat terpenuhi.</div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="checkout">Checkout</button>
          <button id="empty">Kosongkan</button>
        </div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

      <div class="muted" style="font-size:13px">Riwayat pesanan (local)</div>
      <div id="orders" style="margin-top:8px;max-height:180px;overflow:auto"></div>
    </aside>
  </main>

  <footer>
    Demo ini single-file, tanpa server. Simpan, buka di browser, main-main sesukamu.
  </footer>

  <script>
    /* ======== DATA SAMPLE ======== */
    const sampleProducts = [
      {id:'p1', title:'Kaos Gaming "Nusantara"', desc:'Kaos nyaman, ukuran S–XL', price:50000, stock:8, img:'https://picsum.photos/seed/kaos/640/360'},
      {id:'p2', title:'Hoodie Dark', desc:'Hangat, model oversize', price:120000, stock:5, img:'https://picsum.photos/seed/hoodie/640/360'},
      {id:'p3', title:'Topi Snapback', desc:'Ringan & stylish', price:35000, stock:10, img:'https://picsum.photos/seed/topi/640/360'},
      {id:'p4', title:'Mug Keren', desc:'Mug ceramic 350ml', price:40000, stock:15, img:'https://picsum.photos/seed/mug/640/360'},
      {id:'p5', title:'Stiker Pack 20', desc:'Bisa buat laptop & hp', price:25000, stock:30, img:'https://picsum.photos/seed/stiker/640/360'},
      {id:'p6', title:'Action Figure Mini', desc:'Collectible, limited', price:180000, stock:2, img:'https://picsum.photos/seed/fig/640/360'}
    ];

    /* ======== HELPERS ======== */
    const fmt = n => n.toLocaleString('id-ID');
    const el = id => document.getElementById(id);

    /* ======== APP STATE (localStorage) ======== */
    let products = JSON.parse(localStorage.getItem('products')) || sampleProducts;
    let cart = JSON.parse(localStorage.getItem('cart')) || {}; // {productId:qty}
    let orders = JSON.parse(localStorage.getItem('orders')) || [];
    let saldo = Number(localStorage.getItem('saldo') || 0);
    let autoMode = true; // pesanan otomatis (simulasi)

    /* ======== RENDER ======== */
    function renderProducts(filter = '', sort = 'default'){
      let arr = products.filter(p => (p.title + ' ' + p.desc).toLowerCase().includes(filter.toLowerCase()));
      if(sort === 'price-asc') arr.sort((a,b)=>a.price-b.price);
      if(sort === 'price-desc') arr.sort((a,b)=>b.price-a.price);
      const grid = el('grid');
      grid.innerHTML = '';
      arr.forEach(p => {
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `
          <img src="${p.img}" alt="${p.title}">
          <div style="display:flex;justify-content:space-between;align-items:start">
            <div>
              <div style="font-weight:700">${p.title}</div>
              <div class="small">${p.desc}</div>
            </div>
            <div style="text-align:right">
              <div class="price">Rp ${fmt(p.price)}</div>
              <div class="small">Stok: ${p.stock}</div>
            </div>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button data-id="${p.id}" class="add">Tambah</button>
            <button data-id="${p.id}" class="buy">Beli</button>
          </div>
        `;
        grid.appendChild(div);
      });
    }

    function renderCart(){
      el('cartList').innerHTML = '';
      const keys = Object.keys(cart);
      let total = 0, itemCount = 0;
      if(keys.length===0) el('cartList').innerHTML = '<div class="small muted">Keranjang kosong — tambahin barang aja dulu.</div>';
      keys.forEach(pid=>{
        const p = products.find(x=>x.id===pid);
        const qty = cart[pid];
        const row = document.createElement('div');
        row.className='cart-item';
        row.innerHTML = `
          <div style="flex:1">
            <div style="font-weight:600">${p.title}</div>
            <div class="small">${p.desc}</div>
            <div class="small">Rp ${fmt(p.price)} × <input class="qty" data-id="${pid}" value="${qty}" type="number" min="1" max="${p.stock}"></div>
          </div>
          <div style="text-align:right">
            <div style="font-weight:700">Rp ${fmt(p.price * qty)}</div>
            <div style="margin-top:6px"><button data-id="${pid}" class="remove">Hapus</button></div>
          </div>
        `;
        el('cartList').appendChild(row);
        total += p.price * qty;
        itemCount += qty;
      });

      // diskon otomatis: -10% jika total item >=3
      let discount = 0;
      if(itemCount >= 3){
        discount = Math.round(total * 0.10);
      }
      const final = total - discount;
      el('totalRp').textContent = `Rp ${fmt(final)}`;
      el('count').textContent = itemCount;
      el('saldo').textContent = fmt(saldo);
      el('cartCount').querySelector('span').textContent = itemCount;
      // persist
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function renderOrders(){
      const box = el('orders');
      box.innerHTML = '';
      if(orders.length===0) box.innerHTML = '<div class="small muted">Belum ada pesanan.</div>';
      orders.slice().reverse().forEach(o=>{
        const d = document.createElement('div');
        d.className='small';
        d.style.marginBottom='8px';
        d.innerHTML = `<div style="font-weight:700">${o.id}</div>
                       <div class="muted">${o.items.map(i=>i.title+'×'+i.qty).join(', ')}</div>
                       <div class="small">Total: Rp ${fmt(o.total)} — ${o.when}</div>`;
        box.appendChild(d);
      });
    }

    /* ======== ACTIONS ======== */
    function addToCart(pid, qty=1){
      const p = products.find(x=>x.id===pid);
      if(!p) return alert('Produk tidak ditemukan');
      if(p.stock < (cart[pid] || 0) + qty) return alert('Stok tidak cukup');
      cart[pid] = (cart[pid] || 0) + qty;
      saveState();
      renderCart();
      // jika autoMode dan qty besar, trigger auto restock simulation
      if(autoMode && p.stock <= 2){
        // restock otomatis kecil
        p.stock += 5;
        saveState();
        renderProducts(el('q').value, el('sort').value);
      }
    }

    function removeFromCart(pid){
      delete cart[pid];
      saveState();
      renderCart();
    }

    function checkout(){
      const keys = Object.keys(cart);
      if(keys.length===0) return alert('Keranjang kosong.');
      // calculate totals and discount
      let total = 0, itemCount=0;
      const items=[];
      for(const pid of keys){
        const p = products.find(x=>x.id===pid);
        const qty = cart[pid];
        total += p.price * qty;
        itemCount += qty;
        items.push({id:pid,title:p.title,price:p.price,qty});
      }
      let discount = itemCount>=3 ? Math.round(total*0.10) : 0;
      const final = total - discount;
      if(saldo < final) {
        if(!confirm(`Saldo tidak cukup (Rp ${fmt(saldo)}). Bayar pakai saldo? Batal akan simpan keranjang.`)) return;
      }
      // reduce stock
      for(const it of items){
        const p = products.find(x=>x.id===it.id);
        p.stock = Math.max(0, p.stock - it.qty);
      }

      // create order
      const id = 'ORD-' + Date.now().toString(36).toUpperCase().slice(-8);
      const when = new Date().toLocaleString('id-ID');
      const order = {id, items, total:final, when};
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));
      // deduct saldo
      saldo = Math.max(0, saldo - final);
      localStorage.setItem('saldo', saldo);
      // clear cart
      cart = {};
      saveState();
      renderProducts(el('q').value, el('sort').value);
      renderCart();
      renderOrders();
      alert('Checkout sukses — ID: ' + id + '\n(Ini hanya simulasi, tidak ada pengiriman nyata.)');
    }

    function saveState(){
      localStorage.setItem('products', JSON.stringify(products));
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    /* ======== EVENT LISTENERS ======== */
    document.addEventListener('click', e=>{
      if(e.target.matches('.add')) addToCart(e.target.dataset.id,1);
      if(e.target.matches('.buy')){
        addToCart(e.target.dataset.id,1);
        checkout();
      }
      if(e.target.matches('.remove')) removeFromCart(e.target.dataset.id);
      if(e.target.id === 'empty'){
        if(confirm('Kosongkan keranjang?')){ cart={}; saveState(); renderCart(); }
      }
      if(e.target.id === 'checkout') checkout();
      if(e.target.id === 'addSaldo'){
        const val = prompt('Tambah saldo (angka, tanpa titik atau koma). Contoh: 100000 untuk Rp100.000');
        if(!val) return;
        const n = Number(val);
        if(isNaN(n) || n<=0) return alert('Nominal tidak valid');
        saldo += n;
        localStorage.setItem('saldo', saldo);
        el('saldo').textContent = fmt(saldo);
      }
    });

    document.addEventListener('input', e=>{
      if(e.target.matches('.qty')){
        const pid = e.target.dataset.id;
        let v = Number(e.target.value);
        if(isNaN(v) || v < 1) v = 1;
        const p = products.find(x=>x.id===pid);
        if(v > p.stock) { alert('Melebihi stok'); v = p.stock; e.target.value = v; }
        cart[pid] = v;
        saveState();
        renderCart();
      }
    });

    el('q').addEventListener('input', ()=> renderProducts(el('q').value, el('sort').value));
    el('sort').addEventListener('change', ()=> renderProducts(el('q').value, el('sort').value));

    /* ======== INIT ======== */
    // Auto-mode toggle display
    el('autoMode').textContent = autoMode ? 'ON' : 'OFF';

    // If products not in localStorage, seed them
    if(!localStorage.getItem('products')) localStorage.setItem('products', JSON.stringify(products));
    if(!localStorage.getItem('orders')) localStorage.setItem('orders', JSON.stringify(orders));
    if(!localStorage.getItem('saldo')) localStorage.setItem('saldo', saldo);

    renderProducts();
    renderCart();
    renderOrders();

    // small auto feature: jika pesanan masuk dan autoMode true, push notification simulasi
    // (non-intrusive) — akan menambahkan order otomatis setiap 90s jika ada produk stok rendah (simulasi)
    setInterval(()=>{
      if(!autoMode) return;
      // cari produk stok 0 dan buat notifikasi restock
      const low = products.filter(p=>p.stock <= 1);
      if(low.length>0){
        low.forEach(p=>{
          p.stock += 4; // restock otomatis
        });
        saveState();
        renderProducts(el('q').value, el('sort').value);
      }
      // kecil: bersihkan orders lama > 30 hari (simulasi) - tidak dihapus di demo
    }, 90000);

  </script>
</body>
                                                        </html>
